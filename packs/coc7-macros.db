{"name":"Eclairage Cthulhu 2","type":"script","scope":"global","author":"ghmyg1lwP5hPfzt4","img":"modules/coc7-jmn/icons/eclairage.webp","command":"//-------------------------------------------------------------------------------------------------\n// ECLAIRAGE CTHULHU\n//\n// Affectation d'1 éclairage à 1 ou plusieus Tokens (Macro inspirée d'exemples existants).\n//\n// NOTE: Les valeurs numériques pour \"dim\" et \"bright\" sont en mètres et la grille de la scène est\n// configurée 1 case = 1 mètre.\n//\n// Markjan + Grimmbart de Ferdock\n// 19/08/2023\n//-------------------------------------------------------------------------------------------------\n\n//--- Déclarations/Initialisations ...\nconst animationFlamme = { type: \"torch\", speed: 8, intensity: 6 };      // Animation : Flamme\nconst animationTorche = { type: \"torch\", speed: 1, intensity: 1 };      // Animation : Torche\n\nconst listeEclairages = {                                               // Liste des éclairages disponibles\n    aucun: {\n        label: \"Aucun\",\n        data: { dim: null, bright: null, angle: 360, color: null, alpha: null, animation: null, attenuation: 1 }\n    },\n    briquet: {\n        label: \"Briquet\",\n        data: { dim: 2, bright: 0, angle: 360, color: \"#8aeadf\", alpha: 0.4, animation: null, attenuation: 1 }\n    },\n    bougie: {\n        label: \"Bougie\",\n        data: { dim: 3, bright: 1.5, angle: 360, color: \"#ffff00\", alpha: 0.3, animation: animationFlamme, attenuation: 1 }\n    },\n    lampeDePoche: {\n        label: \"Lampe de poche\",\n        data: { dim: 4, bright: 1, angle: 100, color: \"#ffff99\", alpha: 0.8, animation: null, attenuation: 1 }\n    },\n    lampeTorche: {\n        label: \"Lampe torche\",\n        data: { dim: 8, bright: 1.5, angle: 20, color: \"#ffff99\", alpha: 1, animation: null, attenuation: 1 }\n    },\n    lampeAcethylene: {\n        label: \"Lampe à acéthylène\",\n        data: { dim: 12, bright: 4, angle: 360, color: \"#99ff99\", alpha: 1, animation: null, attenuation: 1 }\n    },\n    lampeAcethyleneFrontale: {\n        label: \"Lampe frontale à acéthylène\",\n        data: { dim: 10, bright: 2, angle: 120, color: \"#99ff99\", alpha: 1, animation: null, attenuation: 0.8 }\n    },\n    lampePetrole: {\n        label: \"Lampe à pétrole\",\n        data: { dim: 3, bright: .5, angle: 360, color: \"#ffff99\", alpha: 0.5, animation: null, attenuation: 1}\n    },\n    lampeTempete: {\n        label: \"Lampe tempete\",\n        data: { dim: 6, bright: 2, angle: 360, color: \"#ffff99\", alpha: 0.7, animation: null, attenuation: 0.8 }\n    },\n    lampeGazAlcool: {\n        label: \"Lanterne à gaz d’alcool\",\n        data: { dim: 8, bright: 2, angle: 360, color: \"#9999ff\", alpha: 1, animation: null, attenuation: 0.5 }\n    },\n    torche: {\n        label: \"Torche\",\n        data: { dim: 3, bright: 1, angle: 360, color: \"#99ff99\", alpha: 0.7, animation: animationTorche, attenuation: 1 }\n    }\n};\n\n\n//--- Fonction interne de mise à jour des Tokens\nfunction tokenUpdate(data) {\n    canvas.tokens.controlled.map(token => token.document.update({ light: data }));\n}\n\n\n//--- Création/Configuration des boutons de la boite de dialogue\n// Boucle sur la liste des éclairages (listeEclairages).\n// Pour chaque élément de la liste, on affecte un \"label\" et une \"callback\". Plus loin, chaque élément deviendra un bouton de la boite de dialogue. \nfunction configBoutons() {\n\n    //--- Déclaration\n    let listeBoutons = {};\n\n    //--- Boucle de création des boutons(label + callback)\n    Object.entries(listeEclairages).forEach(([key, light]) => {\n        listeBoutons[key] = {\n            label: light.label,\n            callback: (html) => {\n                //- Maj Token\n                tokenUpdate(light.data);\n                //- On réaffiche la fenêtre\n                dlgElairage.render(true);\n            }\n        }\n    });\n\n    //--- Retour\n    return listeBoutons;\n}\n\n//-------------------------------------------------------------------------------------------------\n// DEBUT SCRIPT\n//-------------------------------------------------------------------------------------------------\n\n//--- Teste si au moins 1 Token est sélectionné\nif (canvas.tokens.controlled.length < 1) {\n    ui.notifications.warn(\"Veuillez sélectionner au moins 1 Token !\");\n    return;\n}\n\n//--- Définition de la boite de dialogue\nlet dlgElairage = new Dialog({\n    title: \"Sélection éclairage\",\n    buttons: configBoutons()\n});\n\n//--- Affichage de la boite de dialogue \ndlgElairage.render(true);","flags":{"core":{"sourceId":"Macro.Fz190wroJsqVpIQc"}},"_stats":{"systemId":"CoC7","systemVersion":"0.10.5","coreVersion":"10.303","createdTime":1680440922693,"modifiedTime":1692470374960,"lastModifiedBy":"ghmyg1lwP5hPfzt4"},"ownership":{"default":0,"ghmyg1lwP5hPfzt4":3},"folder":null,"sort":0,"_id":"jf3OLx5KAgzWJlvf"}
